{% extends "base.html" %}

{% load i18n workbench %}

{% block title %}{% trans 'timestamps'|capfirst %} - {{ block.super }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-10 col-xl-8">

    <div class="card mb-3">
      <div class="card-header d-flex w-100 justify-content-between">
        <h3 class="my-0">
          {% trans "timestamps"|capfirst %}
          <small>
            {% if is_today %}
              <a href="{% url 'logbook_loggedhours_list' %}?rendered_by={{ request.user.pk }}&amp;date_from={% now 'Y-m-d' %}">
                {{ request.user.hours.today|hours }} {% trans 'today' %}</a> /
              <a href="{% url 'logbook_loggedhours_list' %}?rendered_by={{ request.user.pk }}">
                {{ request.user.hours.week|hours }} {% trans 'this week' %}</a>
            {% else %}
              {{ day|local_date_format }} / {{ timestamps.hours|hours }}
            {% endif %}
          </small>
        </h3>
        <div>

          {% if previous %}
          <a href="?day={{ previous.isoformat }}" class="btn btn-primary btn-sm align-self-start"
                                                  title="{% trans 'Previous day' %}">
            &laquo;
          </a>
          {% endif %}

          {% if next %}
          <a href="?day={{ next.isoformat }}" class="btn btn-primary btn-sm align-self-start"
                                              title="{% trans 'Next day' %}">
            &raquo;
          </a>
          {% endif %}

          <a href="{% url 'timestamps-controller' %}?user={{ request.user.signed_email }}&amp;url={{ url }}&amp;title={{ WORKBENCH.TITLE }}"
             class="btn btn-primary btn-sm align-self-start"
             target="_blank"
             rel="noopener noreferrer"
             onclick="window.open(this.href, 'timestamps', 'innerHeight=450,innerWidth=400,resizable=yes,scrollbars=yes,alwaysOnTop=yes,location=no,menubar=no,toolbar=no');return false">
            {% trans 'Controller' %}</a>

        </div>
      </div>

      <div class="ts-list">
        {% for row in timestamps.timestamps %}
          <div class="ts-item ts-{{ row.timestamp.type }}">
            <div class="ts-time">
              <strong>
                {{ row.timestamp.created_at|date:'H:i' }}
              </strong>
              {{ row.timestamp.badge }}
            </div>

            <div class="ts-notes">
              {{ row.timestamp.pretty_notes }}
              {% if row.timestamp.comment %}<em>{{ row.timestamp.comment }}</em>{% endif %}
            </div>

            <div class="ts-actions">
              {% if row.timestamp.logged_hours %}
                <a
                    href="{{ row.timestamp.logged_hours.get_absolute_url }}"
                    data-toggle="ajaxmodal"
                    class="btn btn-sm ml-auto align-self-start btn-light">
                  {{ row.timestamp.logged_hours.hours|hours:True }}
                </a>

              {% elif row.timestamp.logged_break %}
                <a
                   href="{{ row.timestamp.logged_break.get_absolute_url }}"
                   data-toggle="ajaxmodal"
                   class="btn btn-sm ml-auto align-self-start btn-light">
                  {% trans 'break'|capfirst %}
                </a>

              {% else %}

                <div class="ml-auto">

                  {% if not forloop.first %}
                    <a href="{{ row.break_create_url }}"
                       data-toggle="ajaxmodal"
                       class="btn btn-sm align-self-start btn-primary">
                      {% trans 'break'|capfirst %}
                    </a>
                  {% endif %}

                  {% if row.elapsed %}
                    <a
                      href="{{ row.loggedhours_create_url }}"
                      data-toggle="ajaxmodal"
                      class="btn btn-sm align-self-start btn-primary">
                      {{ row.elapsed|hours:True }}
                    </a>
                  {% endif %}

                  {% if row.timestamp.pk %}
                    <form class="d-inline" method="post" action="{{ row.timestamp.get_delete_url }}" onsubmit="return confirm('{% trans 'Really delete?'|escapejs %}')">
                      {% csrf_token %}
                      <button type="submit" class="btn btn-sm btn-outline-danger">&times;</button>
                    </form>
                  {% endif %}

                </div>

              {% endif %}

            </div>
          </div>
        {% endfor %}
      </div>
    </div>

  </div>
</div>
{% endblock %}
