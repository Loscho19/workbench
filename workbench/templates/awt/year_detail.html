{% extends "generic/object_detail.html" %}

{% load i18n workbench %}

{% block content %}
<div class="row justify-content-center">
<div class="col-sm-12">

  <ul class="nav nav-tabs mb-3">
    {% for year in years %}
    <li class="nav-item">
      <a class="nav-link {% if year == object %}active{% endif %}"
        href="{{ year.get_absolute_url }}">{{ year }}</a>
    </li>
    {% endfor %}
  </ul>

  <h1>{{ object|h }} {% history_link object %}</h1>

  <table class="table table-sm table-responsive-lg">
  {% for data in statistics %}
    {% with user=data.user stats=data.months totals=data.totals monthly_sums=data.monthly_sums %}
    <tr><th colspan="14">
      <h5 class="mt-3 mb-0">{{ user }}</h5>
    </th></tr>

    <tr>
      <th></th>
      {% for month in stats.months %}<th class="text-right">{{ month|date:'M' }}</th>{% endfor %}
      <th class="text-right">{% trans 'Total' %}</th>
    </tr>

    <tr>
      <th>{% trans 'working days' %}</th>
      {% for value in stats.target_days %}<td class="text-right {% if not value %}text-black-50{% endif %}">{{ value|days }}</td>{% endfor %}
      <th class="text-right">{{ totals.target_days|days }}</th>
    </tr>

    <tr>
      <th>{% trans 'percentage' %}</th>
      {% for value in stats.percentage %}<td class="text-right {% if not value %}text-black-50{% endif %}">{{ value|stringformat:'.0f' }}%</td>{% endfor %}
      <th class="text-right">{{ totals.percentage|stringformat:'.0f' }}%</th>
    </tr>

    <tr>
      <th>{% trans 'available vacation days' %}</th>
      {% for value in stats.available_vacation_days %}<td class="text-right {% if not value %}text-black-50{% endif %}">{{ value|days }}</td>{% endfor %}
      <th class="text-right">{{ totals.available_vacation_days|days }}</th>
    </tr>

    <tr>
      <th>{% trans 'hours' %}</th>
      {% for value in stats.hours %}<td class="text-right {% if not value %}text-black-50{% endif %}">{{ value|hours }}</td>{% endfor %}
      <th class="text-right">{{ totals.hours|hours }}</th>
    </tr>

    <tr>
      <th>{% trans 'vacation days' %}</th>
      {% for value in stats.vacation_days %}<td class="text-right {% if not value %}text-black-50{% endif %}">{{ value|days }}</td>{% endfor %}
      <th class="text-right">{{ totals.vacation_days|days }}</th>
    </tr>

    {% if totals.vacation_days_correction %}
      <tr>
        <th>{% trans 'correction' %}</th>
        {% for value in stats.vacation_days_correction %}<td class="text-right {% if not value %}text-black-50{% endif %}">{{ value|days }}</td>{% endfor %}
        <th class="text-right">{{ totals.vacation_days_correction|days }}</th>
      </tr>
    {% endif %}

    <tr>
      <th>{% trans 'other absences' %}</th>
      {% for value in stats.other_absences %}<td class="text-right {% if not value %}text-black-50{% endif %}">{{ value|days }}</td>{% endfor %}
      <th class="text-right">{{ totals.other_absences|days }}</th>
    </tr>

    <tr>
      <th>{% trans 'working time' %}</th>
      {% for value in data.working_time %}<td class="text-right {% if not value %}text-black-50{% endif %}">{{ value|days }}</td>{% endfor %}
      <th class="text-right">{{ totals.working_time|days }}</th>
    </tr>

    <tr>
      <th>{% trans 'target' %}</th>
      {% for value in stats.target %}<td class="text-right {% if not value %}text-black-50{% endif %}">{{ value|days }}</td>{% endfor %}
      <th class="text-right">{{ totals.target|days }}</th>
    </tr>

    <tr>
      <th>{% trans 'monthly sums' %}</th>
      {% for value in monthly_sums %}<td class="text-right">{% if value is not None %}{{ value|hours }}{% endif %}</td>{% endfor %}
      <th class="text-right">{{ totals.running_sum|hours }}</th>
    </tr>

    <tr>
      <th>{% trans 'absences' %}</th>
      <td colspan="6">
        <strong>{% trans 'vacation days' %}</strong><br>
        {% for absence in data.absences.vacation_days %}
        {{ absence.days|stringformat:'.02f' }}d ab {{ absence.starts_on|date:'d.m.' }}: {{ absence.description }}<br>
        {% empty %}&ndash;<br>
        {% endfor %}

        <strong>{% trans 'other absences' %}</strong><br>
        {% for absence in data.absences.other_absences %}
        {{ absence.days|stringformat:'.02f' }}d ab {{ absence.starts_on|date:'d.m.' }}: {{ absence.description }}<br>
        {% empty %}&ndash;<br>
        {% endfor %}
      </td>
      <td colspan="6">
        <table class="table table-condensed">
          <tr>
            <th>{% trans 'employment' %}</th>
            <th>{% trans 'percentage' %}</th>
            <th>{% trans 'vacation weeks' %}</th>
            <th>{% trans 'notes' %}</th>
          </tr>
          {% for employment in data.employments %}
          <tr>
            <th>{{ employment }}</th>
            <td>{{ employment.percentage }}%</td>
            <td>{{ employment.vacation_weeks|stringformat:'.0f' }}</td>
            <td>{{ employment.notes|default:'&ndash;' }}</td>
          </tr>
          {% endfor %}
        </table>
      </td>
      <td></td>
    </tr>

    {% endwith %}
  {% endfor %}
  </table>

</div>
</div>
{% endblock %}
