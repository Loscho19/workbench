{% extends "generic/object_detail.html" %}

{% load i18n workbench %}

{% block content %}
<div class="row justify-content-center">
<div class="col-sm-12">

  <ul class="nav nav-tabs mb-3">
    {% for year in years %}
    <li class="nav-item">
      <a class="nav-link {% if year == object %}active{% endif %}"
        href="{{ year.get_absolute_url }}">{{ year }}</a>
    </li>
    {% endfor %}
    <li class="nav-item ml-auto">
      <a class="nav-link" href="{% querystring user='active' %}">{% trans 'active users' %}</a>
    </li>
  </ul>

  <h1>{{ object|h }} {% history_link object %}</h1>

  {% for data in statistics %}
  <div style="break-before:page">

    {% with user=data.user stats=data.months totals=data.totals monthly_sums=data.monthly_sums running_sums=data.running_sums %}
    <h3 class="mt-5">{{ user }}</h3>
    <table class="table table-sm table-bordered table-responsive-lg">
      <tr>
        <th></th>
        {% for month in stats.months %}<th>{{ month|date:'M' }}</th>{% endfor %}
        <th class="text-right">{% trans 'Total' %}</th>
      </tr>

      <tr>
        <th class="text-nowrap">{% trans 'target days for full time employment' %}</th>
        {% for value in stats.target_days %}<td class="text-right {% if not value %}text-black-30{% endif %}">{{ value|days }}</td>{% endfor %}
        <th class="text-right">{{ totals.target_days|days }}</th>
      </tr>

      <tr>
        <th class="text-nowrap">{% trans 'pensum' %}</th>
        {% for value in stats.percentage %}<td class="text-right {% if not value %}text-black-30{% endif %}">{{ value|stringformat:'.0f' }}%</td>{% endfor %}
        <th class="text-right">{{ totals.percentage|stringformat:'.0f' }}%</th>
      </tr>

      <tr>
        <th class="text-nowrap">{% trans 'target time' %}</th>
        {% for value in stats.target %}<td class="text-right {% if not value %}text-black-30{% endif %}">{{ value|hours }}</td>{% endfor %}
        <th class="text-right">{{ totals.target|hours }}</th>
      </tr>

      <tr>
        <th class="text-nowrap">{% trans 'available vacation days' %}</th>
        {% for value in stats.available_vacation_days %}<td class="text-right pr-4 {% if not value %}text-black-30{% endif %}">{{ value|days }}</td>{% endfor %}
        <th class="text-right">{{ totals.available_vacation_days|days }}</th>
      </tr>

      <tr>
        <th class="text-nowrap">{% trans 'vacation days' %}</th>
        {% for value in stats.vacation_days %}<td class="text-right pr-4 {% if not value %}text-black-30{% endif %}">{{ value|days }}</td>{% endfor %}
        <th class="text-right">{{ totals.vacation_days|days }}</th>
      </tr>

      <tr>
        <th class="text-nowrap">{% trans 'other absences' %}</th>
        {% for value in stats.other_absences %}<td class="text-right pr-4 {% if not value %}text-black-30{% endif %}">{{ value|days }}</td>{% endfor %}
        <th class="text-right">{{ totals.other_absences|days }}</th>
      </tr>

      {% if totals.vacation_days_correction %}
        <tr>
          <th class="text-nowrap">{% trans 'vacation days correction' %}</th>
          {% for value in stats.vacation_days_correction %}<td class="text-right pr-4 {% if not value %}text-black-30{% endif %}">{{ value|days }}</td>{% endfor %}
          <th class="text-right">{{ totals.vacation_days_correction|days }}</th>
        </tr>
      {% endif %}

      <tr>
        <th class="text-nowrap">{% trans 'countable absence hours' %}</th>
        {% for value in data.absences_time %}<td class="text-right {% if not value %}text-black-30{% endif %}">{{ value|hours }}</td>{% endfor %}
        <th class="text-right">{{ totals.absences_time|hours }}</th>
      </tr>

      <tr>
        <th class="text-nowrap">{% trans 'hours' %}</th>
        {% for value in stats.hours %}<td class="text-right {% if not value %}text-black-30{% endif %}">{{ value|hours }}</td>{% endfor %}
        <th class="text-right">{{ totals.hours|hours }}</th>
      </tr>

      <tr>
        <th class="text-nowrap">{% trans 'working time' %}</th>
        {% for value in data.working_time %}<td class="text-right {% if not value %}text-black-30{% endif %}">{{ value|hours }}</td>{% endfor %}
        <th class="text-right">{{ totals.working_time|hours }}</th>
      </tr>

      <tr>
        <th class="text-nowrap">{% trans 'net work hours' %}</th>
        {% for value in monthly_sums %}<td class="text-right">{% if value is not None %}{{ value|hours }}{% endif %}</td>{% endfor %}
        <th></th>
      </tr>
      <tr>
        <th class="text-nowrap">{% trans 'running net work hours' %}</th>
        {% for value in running_sums %}<td class="text-right">{% if value is not None %}{{ value|hours }}{% endif %}</td>{% endfor %}
        <th class="text-right">{{ totals.running_sum|hours }}</th>
      </tr>

      {% if totals.vacation_days_credit %}
        <tr>
          <th class="text-nowrap">{% trans 'vacation days credit' %}</th>
          <td colspan="12"> </td>
          <th class="text-right">{{ totals.vacation_days_credit|days }}</th>
        </tr>
      {% endif %}

    </table>

    <table class="table table-sm table-bordered table-responsive-lg">
      <tr>
        <th>{% trans 'employment' %}</th>
        <th>{% trans 'percentage' %}</th>
        <th>{% trans 'vacation weeks' %}</th>
        <th>{% trans 'notes' %}</th>
      </tr>
      {% for employment in data.employments %}
      <tr>
        <th>{{ employment }}</th>
        <td>{{ employment.percentage }}%</td>
        <td>{{ employment.vacation_weeks|stringformat:'.0f' }}</td>
        <td>{{ employment.notes|default:'&ndash;' }}</td>
      </tr>
      {% endfor %}
    </table>
    <table class="table table-sm table-bordered table-responsive-lg">
      <tr>
        <th>{% trans 'absences' %}</th>
        <th>{% trans 'days' %}</th>
        <th>{% trans 'is vacation' %}</th>
        <th>{% trans 'description' %}</th>
      </tr>
      {% for absence in data.absences %}
        <tr>
          <td>
            {% blocktrans with date=absence.starts_on|local_date_format %}from {{ date }}{% endblocktrans %}
          </td>
          <td>{{ absence.days|days }}</td>
          <td>{{ absence.is_vacation|yesno:_('yes,no') }}</td>
          <td>{{ absence.description }}</td>
        </tr>
      {% endfor %}
    </table>

    {% endwith %}

  </div>
  {% endfor %}

</div>
</div>
{% endblock %}
