{% extends "site_base.html" %}

{% load bootstrap4 i18n mark_current static workbench %}

{% block body %}
  <!-- Fixed navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
    <a class="navbar-brand" href="/">{{ WORKBENCH.TITLE }}</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <form class="form-inline mt-2 mb-0 mr-2" method="GET" action="{% url 'search' %}">
            <div class="input-group">
              <input class="form-control" type="search" placeholder="{% trans 'Search'|capfirst %}" aria-label="{% trans 'Search'|capfirst %}" name="q" value="{{ request.GET.q }}">
              <div class="input-group-append">
                <button class="btn btn-outline-secondary" type="submit">{% include 'svg/search.svg' %}</button>
              </div>
            </div>
          </form>
        </li>
        <li class="nav-item"><a class="nav-link" href="/">{% trans 'dashboard'|capfirst %}</a></li>
        {% mark_current request.path %}
        <li class="nav-item"><a class="nav-link" href="{% url 'projects_project_list' %}">{% trans 'projects'|capfirst %}</a></li>
        {% if request.user|has_feature:FEATURES.CONTROLLING %}
          <li class="nav-item"><a class="nav-link" href="{% url 'offers_offer_list' %}">{% trans 'offers'|capfirst %}</a></li>
          <li class="nav-item"><a class="nav-link" href="{% url 'invoices_invoice_list' %}">{% trans 'invoices'|capfirst %}</a></li>
          <li class="nav-item"><a class="nav-link" href="{% url 'deals_deal_list' %}">{% trans 'deals'|capfirst %}</a></li>
        {% endif %}
        <li class="nav-item"><a class="nav-link" href="{% url 'contacts' %}">{% trans 'contacts'|capfirst %}</a></li>

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="logbookDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            {% trans 'logbook'|capfirst %}
          </a>
          <div class="dropdown-menu" aria-labelledby="logbookDropdown">
            <a class="dropdown-item" href="{% url 'logbook_loggedhours_list' %}">{% trans 'logged hours'|capfirst %}</a>
            <a class="dropdown-item" href="{% url 'logbook_loggedcost_list' %}">{% trans 'logged costs'|capfirst %}</a>
            <a class="dropdown-item" href="{% url 'awt_absence_list' %}">{% trans 'absences'|capfirst %}</a>
            {# <div class="dropdown-divider"></div> #}
          </div>
        </li>

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="bookkeepingDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            {% trans 'bookkeeping'|capfirst %}
          </a>
          <div class="dropdown-menu" aria-labelledby="bookkeepingDropdown">
            {% if request.user|has_feature:FEATURES.CONTROLLING %}
              <a class="dropdown-item" href="{% url 'invoices_recurringinvoice_list' %}">{% trans 'recurring invoices'|capfirst %}</a>
              <a class="dropdown-item" href="{% url 'credit_control_creditentry_list' %}">{% trans 'credit entries'|capfirst %}</a>
            {% endif %}
            <a class="dropdown-item" href="{% url 'expenses_expensereport_list' %}">{% trans 'expense reports'|capfirst %}</a>
          </div>
        </li>

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="reportsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            {% trans 'reports'|capfirst %}
          </a>
          <div class="dropdown-menu" aria-labelledby="reportsDropdown">
            {% if request.user|has_feature:FEATURES.CONTROLLING %}
              <a class="dropdown-item" href="{% url 'report_key_data' %}">{% trans 'key data'|capfirst %}</a>
            {% endif %}

            <div class="dropdown-divider"></div>
            <div class="dropdown-header">{% trans 'working time' %}</div>
            <a class="dropdown-item" href="{% url 'awt_year_report' %}">{% trans 'annual working time'|capfirst %}</a>
            <a class="dropdown-item" href="{% url 'awt_absence_calendar' %}">{% trans 'absence calendar' %}</a>

            {% if request.user|has_feature:FEATURES.CONTROLLING %}
              <div class="dropdown-divider"></div>
              <div class="dropdown-header">{% trans 'projects' %}</div>
              <a class="dropdown-item" href="{% url 'report_project_budget_statistics' %}">{% trans 'project budget statistics'|capfirst %}</a>
              <a class="dropdown-item" href="{% url 'report_overdrawn_projects' %}">{% trans 'overdrawn projects'|capfirst %}</a>
              <div class="dropdown-divider"></div>
              <div class="dropdown-header">{% trans 'invoices' %}</div>
              <a class="dropdown-item" href="{% url 'report_open_items_list' %}">{% trans 'open items list'|capfirst %}</a>
              <div class="dropdown-divider"></div>
              <div class="dropdown-header">{% trans 'logged hours' %}</div>
              {% if request.user|has_feature:FEATURES.GLASSFROG %}
                <a class="dropdown-item" href="{% url 'report_hours_by_circle' %}">{% trans 'hours by circle'|capfirst %}</a>
              {% endif %}
              <a class="dropdown-item" href="{% url 'report_hours_per_customer' %}">{% trans 'hours per customer'|capfirst %}</a>
              <a class="dropdown-item" href="{% url 'report_green_hours' %}">{% trans 'green hours'|capfirst %}</a>

              <div class="dropdown-divider"></div>
              <div class="dropdown-header">{% trans 'deals' %}</div>
              <a class="dropdown-item" href="{% url 'report_accepted_deals' %}">{% trans 'accepted deals'|capfirst %}</a>
            {% endif %} {# CONTROLLING #}

            {% if request.user|has_feature:FEATURES.LABOR_COSTS %}
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" href="{% url 'report_labor_costs' %}">{% trans 'labor costs'|capfirst %}</a>
            {% endif %}

          </div>
        </li>
        {% endmark_current %}
      </ul>

      <ul class="navbar-nav ml-auto">
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Hi, {{ user.get_short_name }}!
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">
            <a class="dropdown-item" href="{% url 'accounts_update' %}">{% trans 'Settings'|capfirst %}</a>
            <a class="dropdown-item" href="{% url 'shortcuts' %}">{% trans 'keyboard shortcuts'|capfirst %}</a>
            {% if request.user.is_admin %}
            <a class="dropdown-item" href="{% url 'admin:index' %}">{% trans 'Admin panel'|capfirst %}</a>
            {% endif %}
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="{% url 'timer' %}">{% trans 'timer'|capfirst %}</a>
            <a class="dropdown-item" href="{% url 'timestamps' %}">{% trans 'timestamps'|capfirst %}</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="{% url 'logout' %}">{% trans 'Sign out'|capfirst %}</a>
          </div>
        </li>
      </ul>

    </div>
  </nav>

  <div class="container-fluid flex-grow-1" role="main">

    {% block uplink %}
      {% if view.model.urls.list and view.model.urls.list != request.path %}
        <a href="{{ view.model.urls.list }}" class="btn btn-primary btn-sm uplink">
          {% include 'svg/chevron-left.svg' %} {{ view.meta.verbose_name_plural }}
        </a>
      {% endif %}
    {% endblock %}
    {% bootstrap_messages %}
    {% block content %}{% endblock %}

  </div> <!-- /container -->

  {% block fixed-add-button %}
  <a href="{% url 'logbook_loggedhours_create' %}"
     data-createhours
     data-toggle="ajaxmodal"
     class="btn btn-primary fixed-btn" title="{% trans 'log hours' %}"></a>
  {% endblock %}

{% endblock body %}
