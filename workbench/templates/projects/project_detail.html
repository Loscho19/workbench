{% extends "base.html" %}

{% load history i18n workbench %}

{% block title %}{{ project }} - {% trans "projects" %} - {{ block.super }}{% endblock %}

{% block content %}
<div class="row">
<div class="col-md-12">
  <h1>{{ project }} {% history_link project %}</h1>

  <div class="row">
    <div class="col-md-8">
      {% with overview=project.overview %}
      <table class="table">
        <tr>
          <th>{% trans 'description' %}</th>
          <td>{{ project.description|linebreaksbr|default:'&ndash;' }}</td>
        </tr>
        <tr>
          <th>
            {% trans 'Overall' %}
          </th>
          <td>
            {{ overview.stats.hours }}h / {{ overview.stats.planning }}h
          </td>
        </tr>
        <tr>
          <th>{% trans 'customer' %}</th>
          <td>{% link_or_none project.customer %}</td>
        </tr>
        <tr>
          <th>{% trans 'contact' %}</th>
          <td>{% link_or_none project.contact project.contact.full_name %}</td>
        </tr>
        <tr>
          <th>{% trans 'owned by' %}</th>
          <td>{{ project.owned_by.get_full_name }}</td>
        </tr>
        <tr>
          <th>{% trans 'status' %}</th>
          <td>{{ project.pretty_status }}</td>
        </tr>
      </table>

      <a href="{{ project.urls.createstory }}" class="btn btn-default">
        <i class="glyphicon glyphicon-plus"></i> {% trans 'story' %}</a>
      <a href="{{ project.urls.createoffer }}" class="btn btn-default">
        <i class="glyphicon glyphicon-plus"></i>
        {% trans 'offer' %}</a>
      <a href="{{ project.urls.estimation }}" class="btn btn-default">
        {% trans 'estimation' %}</a>
      <a href="{{ project.urls.update }}" class="btn btn-default">
        {% trans 'Update' %}</a>
      <a href="{{ project.urls.delete }}" class="btn btn-danger btn-inverse pull-right">
        {% trans 'Delete' %}</a>

    </div>

    <div class="col-md-4">
      <a href="{% url 'activities_activity_create' %}?project={{ project.pk }}"
        class="btn btn-default pull-right"
        data-toggle="ajaxmodal">
        <span class="glyphicon glyphicon-plus"></span> {% trans 'activity' %}
      </a>
      <h2>{% trans 'activities' %}</h2>

      <table class="table">
        {% for activity in project.activities.all %}
          <tr class="{{ activity.css }}">
            <th>
              <a href="{{ activity.urls.detail }}" data-toggle="ajaxmodal">
                {{ activity }}
              </a>
            </th>
            <td>
              {{ activity.owned_by.get_full_name }}
            </td>
            <td>
              {{ activity.pretty_status }}
            </td>
          </tr>
        {% endfor %}
      </table>
    </div>
  </div>

      <h2>{% trans 'stories' %}</h2>
      <div class="stories columns">
        {% for status_key, status_title, stories in overview.stories %}
          <div class="column stories--{{ status_key }}">
            <input type="checkbox" checked data-toggle=".stories--{{ status_key }}"/>
            <h3>{{ status_title }}</h3>

            <div class="list-group">
              {% for story in stories %}
                <a class="list-group-item list-group-item-{{ story.css }} story card"
                    href="{{ story.urls.detail }}">

                  <div class="story__avatar">
                    {% if story.owned_by %}
                      <img src="{{ story.owned_by.avatar }}?s=40" alt=""
                        class="avatar"/>
                    {% else %}
                      <i class="glyphicon glyphicon-user avatar"></i>
                    {% endif %}
                  </div>

                  <div class="story__content">
                    <strong class="story__title">{{ story }}</strong>
                  </div>

                  {% with perc=story.stats.used_percentage %}
                  <div class="progress">
                    <div class="progress-bar progress-bar-{{ perc|percentage_to_css }}"
                         role="progressbar"
                         style="width:{{ perc|stringformat:'f' }}%"></div>

                  </div>
                  {% endwith %}
                </a>
              {% endfor %}
            </div>
          </div>
        {% endfor %}
      </div>
      {% endwith %}


</div>
</div>
{% endblock %}
