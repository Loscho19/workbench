{% extends "base.html" %}

{% load history i18n workbench %}

{% block title %}{{ project }} - {% trans "projects" %} - {{ block.super }}{% endblock %}

{% block content %}
<div class="row">
<div class="col-md-12">
{% with overview=project.overview %}
  <h1>{{ project }} {% history_link project %}</h1>

  <div class="row">
    <div class="col-md-8">
      <table class="table">
        <tr>
          <th>{% trans 'description' %}</th>
          <td>{{ project.description|linebreaksbr|default:'&ndash;' }}</td>
        </tr>
        <tr>
          <th>
            {% trans 'Overall' %}
          </th>
          <td>
            {{ overview.stats.logged_hours }}h / {{ overview.stats.effort_hours }}h
          </td>
        </tr>
        <tr>
          <th>{% trans 'customer' %}</th>
          <td>{% link_or_none project.customer %}</td>
        </tr>
        <tr>
          <th>{% trans 'contact' %}</th>
          <td>{% link_or_none project.contact project.contact.full_name %}</td>
        </tr>
        <tr>
          <th>{% trans 'owned by' %}</th>
          <td>{{ project.owned_by.get_full_name }}</td>
        </tr>
        <tr>
          <th>{% trans 'status' %}</th>
          <td>{{ project.pretty_status }}</td>
        </tr>
      </table>

      <a href="{{ project.urls.createtask }}" class="btn btn-default">
        <i class="glyphicon glyphicon-plus"></i> {% trans 'task' %}</a>
      <a href="{{ project.urls.createoffer }}" class="btn btn-default">
        <i class="glyphicon glyphicon-plus"></i>
        {% trans 'offer' %}</a>
      <a href="{{ project.urls.estimation }}" class="btn btn-default">
        {% trans 'estimation' %}</a>
      <a href="{{ project.urls.update }}" class="btn btn-default">
        {% trans 'Update' %}</a>
      <a href="{{ project.urls.delete }}" class="btn btn-danger btn-inverse pull-right">
        {% trans 'Delete' %}</a>

    </div>

    <div class="col-md-4">
      <a href="{% url 'activities_activity_create' %}?project={{ project.pk }}"
        class="btn btn-default pull-right"
        data-toggle="ajaxmodal">
        <span class="glyphicon glyphicon-plus"></span> {% trans 'activity' %}
      </a>
      <h2>{% trans 'activities' %}</h2>

      <table class="table">
        {% for activity in project.activities.all %}
          <tr class="{{ activity.css }}">
            <th>
              <a href="{{ activity.urls.detail }}" data-toggle="ajaxmodal">
                {{ activity }}
              </a>
            </th>
            <td>
              {{ activity.owned_by.get_full_name }}
            </td>
            <td>
              {{ activity.pretty_status }}
            </td>
          </tr>
        {% endfor %}
      </table>
    </div>
  </div>

  <h2>{% trans 'tasks' %}</h2>
  <table class="table table-hover table-striped">
    <thead>
      <tr>
        <th>{% trans 'type' %}</th>
        <th>{% trans 'priority' %}</th>
        <th>{% trans 'title' %}</th>
        <th>{% trans 'status' %}</th>
        <th>{% trans 'created at' %}</th>
        <th>{% trans 'owned by' %}</th>
      </tr>
    </thead>
    <tbody>
      {% for task in tasks %}

        {% if tasks_view == 'services' %}
        {% ifchanged task.service %}
        <tr>
          <th colspan="6">
            <h3>
              {{ task.service|default:_('No service') }}
            </h3>
          </th>
        </tr>
        {% endifchanged %}
        {% endif %}

        <tr>
          <td>
            <i
              title="{{ task.get_type_display }}"
              class="{{ task.type_css }}"></i>
          </td>
          <td>
            <span
              title="{{ task.get_priority_display }}"
              class="{{ task.priority_css }}">&nbsp;</span>
          </td>
          <th><a href="{{ task.get_absolute_url }}">{{ task|h }}</a></th>
          <td>{{ task.get_status_display }}</td>
          <td>{{ task.created_at|date:'d.m.Y' }}</td>
          <td>
            {{ task.owned_by|default:'&ndash;' }}
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

{% endwith %}
</div>
</div>
{% endblock %}
