{% extends "base.html" %}

{% load bootstrap3 history i18n workbench %}

{% block title %}{{ task }} - {{ task.project }} - {{ block.super }}{% endblock %}

{% block content %}

<div class="row">
  <div class="col-md-12">

    <h2><a href="{{ task.project.get_absolute_url }}">
        <small><i class="glyphicon glyphicon-menu-left"></i></small>
        {{ task.project|h }}</a></h2>

    <h1>{{ task|h }} {% history_link task %}</h1>

    <div class="row">
      <div class="col-md-8">

        <table class="table table-striped">
          {% for name, value in object|field_value_pairs:'created_at,description,type,priority,owned_by' %}
          <tr>
            <th class="text-right">{{ name }}</th>
            <td>{% link_or_none value %}</td>
          </tr>
          {% endfor %}
          <tr>
            <th class="text-right">{% trans 'service' %}</th>
            <td>
              {% link_or_none object.service %}
              HOURS ETC.
            </td>
          </tr>
          <tr>
            <th class="text-right">{% trans 'status' %}</th>
            <td>{{ object.pretty_status }}</td>
          </tr>
        </table>

        <a href="{{ task.urls.update }}" class="btn btn-default">
          {% trans 'Update' %}
        </a>
        <a href="{{ task.urls.delete }}" class="btn btn-danger btn-inverse pull-right">
          {% trans 'Delete' %}
        </a>


        <h3>{% trans 'comments' %}</h3>
        {% for comment in task.comments.all|select_related:'created_by' %}
        <div class="comment">
          <h4>{{ comment.created_by }} {{ comment.created_at }}</h4>
          {{ comment.html }}
        </div>
        {% endfor %}

        <div class="comment">
          <h4>{{ request.user }}</h4>
          <form method="post" action="{{ request.path }}" class="form">
            <input type="hidden" name="form" value="comment_form"/>
            {% csrf_token %}
            {% bootstrap_form comment_form layout='inline' %}
            <button type="submit" class="btn btn-primary">
              {% trans 'add comment' %}
            </button>
          </form>
        </div>


      </div>
      <div class="col-md-4">
        <form method="post" action="{{ request.path }}" class="form">
          <h4>{% trans 'logged hours' %}</h4>
            <input type="hidden" name="form" value="logbook_form"/>
          {% csrf_token %}
          {% bootstrap_form logbook_form layout='inline' %}
          <button type="submit" class="btn btn-primary">
            {% trans 'create' %}
          </button>
        </form>

        <table class="table table-striped table-hover">
          {% for hours in task.loggedhours.all|select_related:'rendered_by' %}
          <tr>
            <td>{{ hours.rendered_by.get_short_name }}</td>
            <td>{{ hours.rendered_on|date:'d.m.Y' }}</td>
            <td>{{ hours.hours }}h</td>
            <td>{{ hours.description }}</td>
          </tr>
          {% endfor %}
        </table>
      </div>
    </div>

  </div>
</div>

{% endblock %}
