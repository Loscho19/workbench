{% extends "base.html" %}

{% load bootstrap4 history i18n querystring workbench %}

{% block title %}{% trans 'services' %} - {{ view.project }} - {{ block.super }}{% endblock %}

{% block content %}
<div class="row">
  <div class="col-sm-12">

    <h1>{{ view.project|h }} {% history_link view.project %}</h1>
    <ul class="nav nav-tabs">
      <li class="nav-item"><a class="nav-link" href="{{ view.project.urls.overview }}">{% trans 'overview' %}</a></li>
      <li class="nav-item active"><a class="nav-link" href="{{ view.project.urls.services }}">{% trans 'services' %}</a></li>
      <li class="nav-item"><a class="nav-link" href="{{ view.project.urls.costs }}">{% trans 'costs' %}</a></li>
    </ul>

{% block objects %}

<table class="table table-hover table-striped table-linearize">
  <tbody>
    {% for service in object_list|select_related:'offer'|prefetch_related:'efforts__service_type,costs'|services_info:view.project %}
      {% ifchanged service.offer %}
      <tr>
        <th colspan="3">
          {% if service.offer %}
            <a href="{{ service.offer.get_absolute_url }}">
              {{ service.offer|h }}
              <span class="badge badge-{{ service.offer.status_css }}">{{ service.offer.pretty_status }}</span>
            </a>
          {% else %}Noch nicht offeriert
          {% endif %}
        </th>
      </tr>
      {% endifchanged %}
      <tr>
        <td style="padding-left:4rem">
          {% if not service.offer or not service.offer.is_locked %}
            <a href="{{ service.urls.update }}"><strong>{{ service }}</strong></a>
          {% else %}
            <strong>{{ service }}</strong>
          {% endif %}
          <br>
          {{ service.description|linebreaksbr }}<br><br>
          {% for effort in service.efforts.all %}
            {{ effort.hours }}h {{ effort.service_type }}{% if not forloop.last %},{% endif %}
          {% endfor %}
          {% for cost in service.costs.all %}
            {{ cost.title }} ({{ cost.cost|currency }}){% if not forloop.last %},{% endif %}
          {% endfor %}
        </td>
        <th class="text-right">{{ service.logged_hours }}h / {{ service.effort_hours }}h</th>
        <th style="white-space:nowrap">
          <a href="{{ view.project.urls.createhours }}?service={{ service.pk }}"
            data-toggle="ajaxmodal">
            {% include "svg/plus.svg" %} {% trans 'hours' %}</a>
          <a href="{{ view.project.urls.createcost }}?service={{ service.pk }}"
            data-toggle="ajaxmodal">
            {% include "svg/plus.svg" %} {% trans 'cost' %}</a>
        </th>
      </tr>
    {% endfor %}
  </tbody>
</table>

{% endblock %}

    {% comment %}
    <a href="{{ view.project.urls.createtask }}" class="btn btn-secondary">
      {% include "svg/plus.svg" %} {% trans 'task' %}</a>
    {% endcomment %}
    <a href="{{ view.project.urls.createservice }}" class="btn btn-secondary">
      {% include "svg/plus.svg" %} {% trans 'service' %}</a>
    <a href="{{ view.project.urls.createhours }}" class="btn btn-secondary"
      data-toggle="ajaxmodal">
      {% include "svg/plus.svg" %} {% trans 'hours' %}</a>

  </div>
</div>
{% endblock %}
