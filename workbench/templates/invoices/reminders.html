{% extends "base.html" %}
{% load i18n workbench %}

{% block title %}{% translate 'Reminders' %} - {{ block.super }}{% endblock %}

{% block content %}
  <div class="row">
    <div class="col-sm-12">
      <h1>{% translate 'Reminders' %}</h1>

      <table class="table table-responsive-lg">
        <thead class="sticky">
          <tr>
            <th class="">{% translate 'contact'|capfirst %}</th>
            <th class="text-nowrap">{% translate 'invoice'|capfirst %}</th>
            <th class="text-nowrap">PDF</th>
            <th class="text-nowrap text-right">{% translate 'Total excl. tax' %}</th>
            <th class="text-nowrap text-right">{% translate 'invoiced on'|capfirst %}</th>
            <th class="text-nowrap text-right">{% translate 'Last reminded on' %}</th>
          </tr>
        </thead>
        <tbody>
          {% for customer, contact_invoices in nested.items %}
          {% for contact, invoices in contact_invoices.items %}
          {% for invoice in invoices %}
          {% ifchanged invoice.customer %}
          <tr>
            <th colspan="6">{% link_or_none invoice.customer %}</th>
          <tr>
          {% endifchanged %}
          <tr>
            <td>{% ifchanged invoice.contact %}{% link_or_none invoice.contact %}{% endifchanged %}</td>
            <td>{% link_or_none invoice %}</td>
            <td><a href="{{ invoice.urls.pdf }}?disposition=attachment">PDF</a></td>
            <td class="text-nowrap text-right">{{ invoice.total_excl_tax|currency }}</td>
            <td class="text-nowrap text-right">{{ invoice.invoiced_on|local_date_format }}</td>
            <td class="text-nowrap text-right">
              {{ invoice.last_reminded_on|local_date_format|default:_("Not reminded yet") }}
              <form method="post" class="d-inline">
                {% csrf_token %}
                <input type="hidden" name="invoice" value="{{ invoice.pk }}">
                <button type="submit" class="btn btn-link px-0 py-0">{% translate 'today' %}</button>
              </form>
            </td>
          </tr>
          {% endfor %}
          {% endfor %}
          {% endfor %}
        </tbody>
      </table>

    </div>
  </div>
{% endblock %}
