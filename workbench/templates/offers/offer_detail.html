{% extends "base.html" %}

{% load history i18n workbench %}

{% block title %}{{ object }} - {{ view.meta.verbose_name_plural }} - {{ block.super }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
<div class="col-md-10 col-lg-8">
  <h1>{{ object }} {% history_link object %}</h1>

  <table class="table table-striped">
    {% for name, value in object|field_value_pairs:'project,description,owned_by' %}
    <tr>
      <th class="text-right">{{ name }}</th>
      <td>{% link_or_none value %}</td>
    </tr>
    {% endfor %}
    <tr>
      <th class="text-right">{% trans 'status' %}</th>
      <td><span class="badge badge-{{ object.status_css }}">
        {{ object.pretty_status }}
      </span></td>
    </tr>
    <tr>
      <th class="text-right">{% trans 'postal address' %}</th>
      <td>{{ object.postal_address|linebreaksbr }}</td>
    </tr>
  </table>

  <table class="table table-striped table-hover">
    {% for service in object.services.all|prefetch_related:'efforts__service_type,costs' %}
      <tr>
        <td>
          <a href="{{ service.urls.move }}?up" class="move" title="{% trans 'Move up' %}">
            {% include "svg/chevron-up.svg" %}
          </a>
          <a href="{{ service.urls.move }}?down" class="move" title="{% trans 'Move down' %}">
            {% include "svg/chevron-down.svg" %}
          </a>
        </td>
        <td colspan="3">
          <a href="{{ service.urls.update }}">
            <strong>{{ service.title }}</strong>
          </a>
          {% if service.description %}
            <br>
            {{ service.description|linebreaksbr }}
          {% endif %}
        </td>
      </tr>
      {% for effort in service.efforts.all %}
        <tr>
          <td></td>
          <td>{{ effort.service_type }}</td>
          <td class="text-right">{{ effort.hours }}h</td>
          <td class="text-right">{{ effort.cost|currency }}</td>
        </tr>
      {% endfor %}
      {% for cost in service.costs.all %}
        <tr>
          <td></td>
          <td colspan="2">{{ cost.title }}</td>
          <td class="text-right">{{ cost.cost|currency }}</td>
        </tr>
      {% endfor %}
    {% endfor %}
    <tfoot>
      <tr>
        <td></td>
        <th colspan="2">{% trans 'subtotal' %}</th>
        <td class="text-right">{{ object.subtotal|currency }}</td>
      </tr>
      {% if object.discount %}
        <tr>
          <td></td>
          <th colspan="2">{% trans 'discount' %}</th>
          <td class="text-right">-{{ object.discount|currency }}</td>
        </tr>
      {% endif %}
      {% if object.liable_to_vat and object.subtotal != object.total_excl_tax %}
        <tr>
          <td></td>
          <th colspan="2">{% trans 'total excl. tax' %}</th>
          <td class="text-right">{{ object.total_excl_tax|currency }}</td>
        </tr>
      {% endif %}
      <tr>
        <td></td>
        <th colspan="2">{{ object.total_title }}</th>
        <td class="text-right">{{ object.total|currency }}</td>
      </tr>
    </tfoot>
  </table>

  <a href="{{ object.project.urls.createservice }}" class="btn btn-secondary">
    {% include 'svg/plus.svg' %} {% trans 'service' %}
  </a>
  <a href="{{ object.urls.pdf }}" class="btn btn-secondary">
    PDF
  </a>
  <a href="{{ object.urls.update }}" class="btn btn-secondary">
    {% trans 'Update' %}
  </a>
  <a href="{{ object.urls.delete }}" class="btn btn-outline-danger float-right">
    {% trans 'Delete' %}
  </a>
</div>
</div>
{% endblock %}
