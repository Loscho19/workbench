{% extends "base.html" %}

{% load fineforms i18n static workbench %}

{% block title %}{% trans 'Accepted deals' %} - {{ block.super }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
<div class="col-sm-12 col-md-8">
  <h1>{% trans 'Accepted deals' %}</h1>

  <form method="get" class="mb-3" data-autosubmit>
    {% ff_fields form %}
  </form>

  <table class="table table-sm table-striped">
    <thead>
      <tr>
        <th>{% trans 'month'|capfirst %}</th>
        {% for row in stats.by_valuetype %}
          <th class="text-right">{{ row.type }}</th>
        {% endfor %}
        <th class="text-right">{% trans 'total'|capfirst %}</th>
      </tr>
    </thead>
    <tbody>
      {% for row in stats.by_month_and_valuetype %}
      <tr>
        <td>{{ row.month|date:'F Y' }}</td>
        {% for value in row.values %}
          <td class="text-right">{{ value.value|currency }}</td>
        {% endfor %}
        <td class="text-right">{{ row.sum|currency }}</td>
      </tr>
      {% endfor %}
      <tr>
        <th>{% trans 'total'|capfirst %}</th>
        {% for row in stats.by_valuetype %}
          <th class="text-right">{{ row.sum|currency }}</th>
        {% endfor %}
        <th class="text-right">{{ stats.sum|currency }}</th>
      </tr>
      <tr>
        <th>{% trans 'target'|capfirst %} ({{ stats.weeks|stringformat:'.1f' }} {% trans 'weeks' %})</th>
        {% for row in stats.by_valuetype %}
          <th class="text-right">
            {{ row.target|currency }}
            <div style="margin:-5px 0;display:inline-block">
              {% pie row.sum row.target type='good' size=28 %}
            </div>
          </th>
        {% endfor %}
        <th class="text-right">
          {{ stats.target|currency }}
          <div style="margin:-5px 0;display:inline-block">
            {% pie stats.sum stats.target type='good' size=28 %}
          </div>
        </th>
      </tr>
    </tbody>
  </table>

  <table class="table table-sm table-striped">
    <thead>
      <tr>
        <th>{% trans 'user'|capfirst %}</th>
        <th class="text-right">{% trans 'count'|capfirst %}</th>
        <th></th>
        <th class="text-right">{% trans 'value'|capfirst %}</th>
      </tr>
    </thead>
    <tbody>
      {% for row in stats.by_user %}
      <tr>
        <td>
          <a href="deals/{% querystring user=row.user.id %}" data-toggle="ajaxmodal">{{ row.user }}</a>
        </td>
        <td class="text-right">{{ row.count }}</td>
        <td class="text-right">
          <div style="margin:-5px 0;display:inline-block">
            {% pie row.sum stats.sum type='good' size=28 %}
          </div>
        </td>
        <td class="text-right">
          {{ row.sum|currency }}
        </td>
      </tr>
      {% endfor %}
      <tr>
        <th>{% trans 'total'|capfirst %}</th>
        <th class="text-right">{{ stats.count }}</th>
        <th></th>
        <th class="text-right">{{ stats.sum|currency }}</th>
      </tr>
    </tbody>
  </table>

</div>
</div>
{% endblock %}
