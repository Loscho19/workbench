TRUNCATE awt_year RESTART IDENTITY CASCADE;
TRUNCATE awt_employment RESTART IDENTITY CASCADE;
TRUNCATE awt_absence RESTART IDENTITY CASCADE;

INSERT INTO awt_year (
  year,
  working_time_per_day,
  january,
  february,
  march,
  april,
  may,
  june,
  july,
  august,
  september,
  october,
  november,
  december
)
SELECT
  year,
  working_time_per_day,
  january,
  february,
  march,
  april,
  may,
  june,
  july,
  august,
  september,
  october,
  november,
  december
FROM
dblink(
  'dbname=fineware_feinheit',
  'SELECT year, working_time_per_day, january, february, march, april, may, june, july, august, september, october, november, december FROM resources_annualworkingtime'
) AS p(
  year int,
  working_time_per_day numeric(4,2),
  january numeric(4,2),
  february numeric(4,2),
  march numeric(4,2),
  april numeric(4,2),
  may numeric(4,2),
  june numeric(4,2),
  july numeric(4,2),
  august numeric(4,2),
  september numeric(4,2),
  october numeric(4,2),
  november numeric(4,2),
  december numeric(4,2)
);

INSERT INTO awt_employment (
  user_id,
  date_from,
  date_until,
  percentage,
  vacation_days,
  notes
)
SELECT
  user_id,
  date,
  date '9999-12-31',
  percent,
  vacation_days,
  notes
FROM
dblink(
  'dbname=fineware_feinheit',
  'SELECT p.user_id, e.date, e.percent, e.vacation_days, e.notes FROM accounts_employment e LEFT JOIN accounts_profile p ON e.profile_id=p.id'
) AS p(
  user_id int,
  date date,
  percent int,
  vacation_days numeric(4,2),
  notes text
);

INSERT INTO awt_absence (
  user_id,
  starts_on,
  days,
  description,
  is_vacation
)
SELECT
  user_id,
  starts_on,
  days,
  CONCAT(reason, ': ', notes),
  reason = 'vacation'
FROM
dblink(
  'dbname=fineware_feinheit',
  'SELECT worker_id, date_from, days, notes, reason FROM resources_absence'
) AS p(
  user_id int,
  starts_on date,
  days numeric(4,2),
  notes text,
  reason varchar(16)
);
